# ~/.tmux.conf : tmux configuration file

# Increase scrollback buffer size (default: 2000)
set -g history-limit 10000

# Increase tmux messages display duration (default: 750ms)
set -g display-time 2500

# Refresh 'status-left' and 'status-right' more often (default: 15s)
set -g status-interval 5

# Address vim mode switching delay (http://superuser.com/a/252717/65504)
set -s escape-time 50

# renumber windows when a window is closed
set -g renumber-windows on

# rename window to reflect current program
setw -g automatic-rename on

# Enable terminal features
set -as terminal-features ',linux*:256'
set -as terminal-features ',alacritty*:clipboard:RGB:ccolour:cstyle:extkeys:focus:mouse:strikethrough:usstyle'
set -as terminal-features ',foot*:clipboard:RGB:ccolour:cstyle:extkeys:focus:mouse:strikethrough:usstyle'
set -as terminal-features ',ghostty*:clipboard:RGB:ccolour:cstyle:extkeys:focus:mouse:strikethrough:usstyle'
set -as terminal-features ',kitty*:clipboard:RGB:ccolour:cstyle:extkeys:focus:mouse:strikethrough:usstyle'
set -as terminal-features ',st*:clipboard:RGB:ccolour:cstyle:extkeys:focus:mouse:strikethrough:usstyle'
set -as terminal-features ',vte*:RGB:ccolour:cstyle:focus:mouse:strikethrough:usstyle'
set -as terminal-features ',wezterm*:clipboard:RGB:ccolour:cstyle:extkeys:focus:mouse:strikethrough:usstyle'
set -as terminal-features ',xterm*:clipboard:256:RGB:ccolour:cstyle:extkeys:focus:mouse:strikethrough:title:usstyle'

# Enable 24-bit color
set -ag terminal-overrides ',*-truecolor:Tc'
set -ag terminal-overrides ',alacritty*:Tc'
set -ag terminal-overrides ',foot*:Tc'
set -ag terminal-overrides ',ghostty*:Tc'
set -ag terminal-overrides ',kitty*:Tc'
set -ag terminal-overrides ',st*:Tc'
set -ag terminal-overrides ',vte*:Tc'
set -ag terminal-overrides ',wezterm*:Tc'
set -ag terminal-overrides ',xterm*:Tc'

# Enable extended key CSI u format for extended keys if sensible
%if #{||:#{!=:#{XTERM_VERSION},},#{m/ri:^(alacritty|foot|ghostty|iterm|kitty|mintty|st|wezterm)(-.+)?$,#{TERM}}}
set -g extended-keys-format csi-u
%endif
set -g extended-keys on

# Register terminal focus events
set -g focus-events on

# Enable mouse and clipboard
set -g mouse on
set -g set-clipboard external

# Update terminal titles
set -g set-titles on
set -g set-titles-string '#T'

# Set a modern terminal type
set -g default-terminal 'tmux-256color'

# Use UTF-8 to encode statusbar
set -g status on

# Enable window notifications
set -g visual-activity on
setw -g monitor-activity on

# Count from one
set -g base-index 1
setw -g pane-base-index 1

# Enable vim-style keybindings
set -g mode-keys vi

# Use emacs key bindings in tmux command prompt `'<Prefix>:'`
set -g status-keys emacs

# Set the selection style
set -wg mode-style 'bg=black fg=default italics'

# Set prefix key to Ctrl+Backslash
unbind C-b
set -g prefix "C-\\"
bind "C-\\" send-prefix

# Cycle windows with Prefix Ctrl-n and Prefix Ctrl-p
unbind d
bind C-d 'detach-client'

# Split panes with ease
unbind '"'
unbind '%'
bind 'C-v' 'split-window -h'
bind 'C-x' 'split-window -v'

# Switch panes like vim
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes like vim
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Cycle windows with Ctrl-PageUp and Ctrl-PageDown (no prefix)
unbind -n C-PgUp
unbind -n C-PgDn
bind -n -r C-PgUp select-window -n
bind -n -r C-PgDn select-window -p

# Cycle windows with Prefix Ctrl-n and Prefix Ctrl-p
unbind n
bind -r C-n next-window
unbind p
bind -r C-p previous-window

# Enable vim-style copy-and-paste
bind Escape copy-mode

# Bind select, copy, and paste to "v", "y", and "p", respectively
unbind v
bind -T copy-mode-vi v 'send-keys -X begin-selection'
bind -T copy-mode-vi y 'send-keys -X copy-pipe "{ pbcopy || clipcopy || wl-copy -n || xclip -selection clipboard; } 2> /dev/null" ; send-keys -X clear-selection'
unbind +
bind + run '{ pbpaste || clippaste || wl-paste -n || xclip -o -selection clipboard; } 2> /dev/null | tmux load-buffer - && tmux paste-buffer'

# Let single click do selection clearing
bind -T copy-mode-vi MouseDown1Pane 'select-pane ; send-keys -X clear-selection'

# Disable 'release mouse drag to copy and exit copy-mode'
unbind -T copy-mode-vi MouseDragEnd1Pane

# Begin scrolling with Shift-PageUp
bind -n -r S-PgUp 'copy-mode -eu'

# Load tmuxline config if available
if-shell 'test -f ~/.tmuxline.conf' 'source ~/.tmuxline.conf'

# # Setup tpm plugins (https://github.com/tmux-plugins/tpm)
# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'erikw/tmux-powerline.git'
# #
# # Initialize tmux plugin manager (keep this line last)
# run '~/.tmux/plugins/tpm/tpm'

# vim:ft=tmux:tw=0
